<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta http-equiv="X-UA-Compatible" content="ie=edge" />

      <!-- Latest compiled and minified CSS -->
      <link
         rel="stylesheet"
         href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"
      />

      <!-- jQuery library -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

      <!-- Latest compiled JavaScript -->
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

      <!-- Put in some bootstrap -->
      <link
         rel="stylesheet"
         href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
         integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
         crossorigin="anonymous"
      />

      <!-- Javascript -->
      <script
         src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
         integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
         crossorigin="anonymous"
      ></script>
      <script
         src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
         integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
         crossorigin="anonymous"
      ></script>
      <script
         src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
         integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
         crossorigin="anonymous"
      ></script>

      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="/socket.io/socket.io.js"></script>

      <style>
         body {
            margin-top: 30px;
         }

         #messageArea {
            display: none;
         }
      </style>

      <title>Real Time Chat</title>
   </head>
   <body>
      <div class="container">
         <div id="userFormArea" class="row">
            <div class="col-md-12">
                  <form id="userForm" action="" method="">
                        <div class="form-group">
                           <label>Enter Username</label>
                           <input class="form-control" id="username" />
                           <br />
                           <input
                              type="submit"
                              class="btn btn-primary"
                              value="Login"
                           />
                        </div>
                     </form>
            </div>
         </div>
         <div id="messageArea" class="row">
            <div class="col-md-4">
               <div class="well">
                  <h3>Online Users</h3>
                  <ul class="list-group" id="users"></ul>
               </div>
            </div>
            <div class="col-md-8">
               <div class="chat" id="chat"></div>
               <form id="messageForm" action="" method="">
                  <div class="form-group">
                     <label>Enter Message</label>
                     <textarea class="form-control" id="message"></textarea>
                     <br />
                     <input
                        type="submit"
                        class="btn btn-primary"
                        value="Send Message"
                     />
                  </div>
               </form>
            </div>
         </div>
      </div>
      <script>
         $(function() {
            // Load data into variables
            var socket = io.connect();
            var $messageForm = $("#messageForm");
            var $message = $("#message");
            var $chat = $("#chat");
            var $messageArea = $("messageArea");
            var $userFormArea = $("userFormArea");
            var $userForm = $("userForm");
            var $users = $("users");
            var $username = $("username");

            // This will prevent the form from reloading and send the message
            $messageForm.submit(function(e) {
               // this will keep the page from reloading
               e.preventDefault();
               socket.emit("send message", $message.val());
               // this will reset the textarea after we send the message
               $message.val("");
            });

            // This will display the messages on the web-app
            socket.on("new message", function(data) {
               $chat.append(`<div class="well">${data.msg}</div>`);
            });

            // This function submits the users credentials
            $userForm.submit(function(e) {
               e.preventDefault();
               socket.emit("new user", $username.val(), function(data) {
                  if (data) {
                     $userFormArea.hide();
                     $messageArea.show();
                  }
               });
               $username.val("");
            });

            // get all users and display them to the page
            socket.on('get users', function(data) {
               var html = '';
               for (var i = 0; i < data.length; i++) {
                  html += `<li class="list-group-item">${data[i]}</li>`
               }
               $users.html(html);
            });
         });
      </script>
   </body>
</html>
